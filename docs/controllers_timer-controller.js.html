<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: controllers/timer-controller.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: controllers/timer-controller.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const MS_PER_SECOND = 1000;

/**
 * Provides wall-clock time, and callbacks for timed events
 */
export class TimerController {
  /**
   * Creates a TimerController
   */
  constructor() {
    this.timeCallbacks = {};
    this.alarmCallbacks = {};
    this.timeRemaining = 0;
    this.ticker = setInterval(() => this._tick.call(this), MS_PER_SECOND);
  }

  /**
   * Registers a callback to be called once a second, on every tick of the timer
   * @param id - unique ID to refer to this callback
   * @param callback - callback to be run every second
   * @returns {function(): boolean} - call to clear the callback
   */
  addTimeCallback(id, callback) {
    this.timeCallbacks[id] = callback;
    return () => delete this.timeCallbacks[id];
  }

  /**
   * Registers a callback to be called when the timer reaches 0
   * @param id - unique ID to refer to this callback
   * @param callback - callback to be run when the timer reaches 0
   * @returns {function(): boolean} - call to clear the callback
   */
  addAlarmCallback(id, callback) {
    this.alarmCallbacks[id] = callback;
    return () => delete this.alarmCallbacks[id];
  }

  /**
   * Sets the timer to some number of seconds
   * @param timeSeconds - time in seconds
   */
  set(timeSeconds) {
    this.timeRemaining = timeSeconds;
    clearInterval(this.ticker);
    this.ticker = setInterval(() => this._tick.call(this), MS_PER_SECOND);
  }

  /**
   * Called every second to decrement the timer and fire callbacks
   * @private
   */
  _tick() {
    this.timeRemaining--;
    for (const callback of Object.values(this.timeCallbacks)) {
      callback(this.timeRemaining);
    }

    if (this.timeRemaining === 0) {
      clearInterval(this.ticker);
      for (const callback of Object.values(this.alarmCallbacks)) {
        callback();
      }
    }
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="PomoCounterController.html">PomoCounterController</a></li><li><a href="TimerController.html">TimerController</a></li></ul><h3>Global</h3><ul><li><a href="global.html#square">square</a></li><li><a href="global.html#Stages">Stages</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Tue Feb 16 2021 21:57:38 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
